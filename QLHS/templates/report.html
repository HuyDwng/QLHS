{% extends 'layout/base.html' %}

{% block content %}
<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">Quản lý học sinh</a>

        <div class="collapse navbar-collapse" id="collapsibleNavbar">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/manage">Quản lý môn học</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/rule">Thay đổi quy định</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/report">Thống kê và báo cáo</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/register">Tạo tài khoản</a>
                </li>
            </ul>
        </div>
        <div class="d-flex">
            <a class="nav-link text-info" href="/logout">Đăng xuất</a>
        </div> 
    </div>
</nav>

<div class="container mt-5">
    <h2 class="text-center">Báo cáo tổng kết môn học</h2>
    <form action="/report" method="POST" class="mt-4">
        <div class="mb-3">
            <label for="subject" class="form-label">Môn học</label>
            <select class="form-select" id="subject" name="subject" required>
                {% for subject in subjects %}
                    <option value="{{ subject[0] }}">{{ subject[1] }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="year" class="form-label">Năm học</label>
            <select class="form-select" id="year" name="year" required>
                {% for year in years %}
                    <option value="{{ year[0] }}">{{ year[1] }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="semester" class="form-label">Học kỳ</label>
            <select class="form-select" id="semester" name="semester" required>
                <option value="1">Học kỳ 1</option>
                <option value="2">Học kỳ 2</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary w-100">Xem báo cáo</button>
    </form>

    <div class="mt-5">
        <h4>Kết quả báo cáo:</h4>
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Lớp</th>
                        <th>Sĩ số</th>
                        <th>Số lượng đạt</th>
                        <th>Tỷ lệ</th>
                    </tr>
                </thead>
                <tbody>
                    {% if report_data %}
                        {% for row in report_data %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ row['class_name'] }}</td>
                                <td>{{ row['total_students'] }}</td>
                                <td>{{ row['pass_students'] }}</td>
                                <td>{{ row['pass_rate'] }}%</td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="5" class="text-center">Không có dữ liệu</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
